1. 什么是事务

   * 不可分割的操作，假设该操作有ABCD四个步骤组成

     若ABCD四个步骤都成功完成，则认为事务成功

     若ABCD中任意一个步骤操作失败，则认为事务失败

   * 每条SQL语句都是一个事务

   * 事务只对DML语句有效，对于DQL无效

2. 事务的ACID

   * 原子性：事务包含的所有操作要么全部成功，要么全部失败回滚
   * 一致性：事务必须使用数据库从一个一致性状态变化到另一个一致性状态，也就是说一个事务执行之前和执行之后都必须处于一致性状态；让数据保持一定上的合理；一个商品出库时，仓库商品数量减1，对应用户的购物车中商品加1
   * 隔离性：
   * 持久性：

3. 事务的使用

   在开启事务和提交事务之间的SQL语句是一起执行的，如果没有提交事务，那么SQL语句是不执行的

   * 开启事务（`start transaction;`）
   * 提交事务（`commit;`）
   * 回滚事务（`rollback;`）：当遇到突发情况，撤销执行的SQL语句

4. 事务的并发问题

   * 脏读

     A个B打3.6万元，不小心按错成3.9，及时rollback撤回，并修改成3.6后再打钱，但B看到的是3.9万元，这就是**脏读**

     **解决办法：**`read committed;`读提交，能解决脏读问题

   * 不可重复读

     原来卡里有3.6万元，准备支付的前一秒钱被转走了，扣款的时候发现钱没了，这就是**不可重复读**

     **解决办法：**`repeatable read;`可重复读

   * 重复读

     原来卡里有3.6万元，准备支付时就会开启事务，别人不能对卡里的钱做操作，直到支付完成，这就是**可重复读**

   * 幻读

     A今天花了2000元，准备打印今日账单，在打印之前又花了1万元买了电脑，打印出的账单发现多了一条交易记录，这就是**幻读**

     **解决办法：**`serializable;`（这种事务隔离级别效率低下，比较消耗数据库性能，一般不适用）

   * 对应关系

     | 事务隔离级别                 | 脏读 | 不可重复读 | 幻读 |
     | ---------------------------- | ---- | ---------- | ---- |
     | 读未提交(`read uncommitted`) | 是   | 是         | 是   |
     | 不可重复读(`read committed`) | 否   | 是         | 是   |
     | 可重复读(`repeatable read`)  | 否   | 否         | 是   |
     | 串行化(`serializable`)       | 否   | 否         | 否   |

     

5. 事务隔离级别

   * `read uncommitted`：一个事务可以读取另一个未提交事务的数据
   * `read committed`：一个事务要等另一个事务提交后才能读取数据
   * `repeatable read`：MySQL默认的隔离级别
   * `serializable`：串行化

6. 查看隔离级别：`select @@global.tx_isolation,@@tx_isolation;`

7. 设置隔离级别

   * 全局的：`set global transaction isolation level read committed;`
   * 当前会话：`read committed;`

   